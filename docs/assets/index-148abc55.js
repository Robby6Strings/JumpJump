var G=Object.defineProperty;var Q=(s,e,t)=>e in s?G(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var n=(s,e,t)=>(Q(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const h of r)if(h.type==="childList")for(const o of h.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const h={};return r.integrity&&(h.integrity=r.integrity),r.referrerPolicy&&(h.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?h.credentials="include":r.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(r){if(r.ep)return;r.ep=!0;const h=t(r);fetch(r.href,h)}})();var z=(s=>(s[s.NONE=0]="NONE",s[s.CHANGED=1]="CHANGED",s[s.ADDED=2]="ADDED",s[s.REMOVED=3]="REMOVED",s))(z||{});class J{constructor(e,t){n(this,"_val");n(this,"_subscribers",new Set);n(this,"_name");this._val=e,this._name=t}get value(){return this._val}set value(e){this._val=e,this.notify()}notify(){for(const e of this._subscribers)e(this._val)}subscribe(e){return this._subscribers.add(e),this.logSubscriberCount(),e(this._val),()=>this.unsubscribe(e)}unsubscribe(e){this._subscribers.delete(e),this.logSubscriberCount()}serialize(){return JSON.stringify(this.value)}logSubscriberCount(){}}function X(s){return new J(s)}const Z=s=>{switch(s){case"className":return"class";default:return s}},_=s=>{const e={};return Object.keys(s).forEach(t=>{if(!t.includes(":")&&t!=="innerText"&&t!=="children"&&t!=="promise"){if(t==="className"){e.class=s[t];return}if(s[t]instanceof J){e[t]=s[t].value;return}e[t]=s[t]}}),e};class f{static updateElement(e){if(!e.element)return;const{htmlFor:t,children:i,onMounted:r,subscription:h,visible:o,style:a,promise:u,...l}=e.props,p=e.isSVG();if(a&&(typeof a=="object"?Object.assign(e.element.style,a):e.element.setAttribute("style",a)),t&&"htmlFor"in e.element&&(e.element.htmlFor=t),Object.keys(l).length){for(const[v,B]of Object.entries(l))if(!v.includes(":")&&v!=="hydrating"){if(v.startsWith("on")){Object.assign(e.element,{[v]:B});continue}p?e.element.setAttribute(Z(v),e.getPrimitive(B,()=>f.updateElement(e))):Object.assign(e.element,{[v]:e.getPrimitive(B,()=>f.updateElement(e))})}}}static getRenderedChildren(e){return e.children.map((t,i)=>f.renderChild(e,t,i))}static renderChildren(e){e.props.visible&&e.element&&(f.removeFuncComponents(e),e.element.replaceChildren(...f.getRenderedChildren(e)))}static renderChild(e,t,i){if(t instanceof J)return e.subscribeTo((r,h)=>t.subscribe(()=>{const{element:o}=e.element?{element:e.element}:f.getMountLocation(e);if(!o){console.error("Failed to get component mount element",e,t);return}const a=o.childNodes[i];a&&(a.nodeValue=t.value.toString())})),t.value.toString();if(t instanceof y)return!t.props.visible||t.isStatic?"":(t.parent=e,f.render(t));if(typeof t=="function"){let r=t(...e.childArgs);Array.isArray(r)&&(r=new q(r));const h=f.renderChild(e,r,i);if(r instanceof y){if(!r.props.visible||r.isStatic)return"";r.parent=e,e.funcComponents.push(r)}return h}return(t==null?void 0:t.toString())??""}static removeFuncComponents(e){if(e.funcComponents.length>0){for(const t of e.funcComponents)f.unRender(t),C.removeComponentReferences(t);e.funcComponents=[]}}static unRender(e,t=!1){var i;try{if(!t&&e.props.onBeforeUnmounted){const r=e.props.onBeforeUnmounted(e);if(r instanceof Promise){r.then(h=>{h&&f.unRender(e,!0)});return}else if(r===!1)return}if(f.removeFuncComponents(e),e.element)return e.unMount(),e.element.remove();for(const r of e.children)r instanceof y?f.unRender(r):r instanceof Node&&((i=r.parentNode)==null||i.removeChild(r))}catch(r){console.error("failed to unrender",e,r);debugger}}static reRender(e){if(!e.shouldRender())return;const t=e.element??f.render(e,!0);if(e.element&&f.renderChildren(e),t.isConnected)return;const{element:i,idx:r}=f.getMountLocation(e);if(!i){debugger;console.error("Failed to get component mount element",e,t);return}const h=i.childNodes[r-1];h?i.insertBefore(t,h):i.appendChild(t),e.mounted=!0}static render(e,t=!1){const{children:i,subscription:r,promise:h}=e.props;if(C.removeComponentReferences(e),!e.tag){const o=document.createDocumentFragment();return r&&e.subscribeTo(r),o.append(...f.getRenderedChildren(e)),e.mounted=!0,!t&&"setPromise"in e&&typeof e.setPromise=="function"&&e.setPromise(h),o}return e.tag.toLowerCase()==="svg"?f.svg(e):(e.element||(e.element=document.createElement(e.tag)),i&&e.replaceChildren(i),f.renderChildren(e),f.updateElement(e),r&&e.subscribeTo(r),e.mounted=!0,e.element)}static diffCheckChildren(e,t){const i=e.map(l=>l.props.key),r=t.map(l=>l.props.key),h=t.filter(l=>!i.includes(l.props.key)).map(l=>l.props.key),o=e.filter(l=>!r.includes(l.props.key)).map(l=>l.props.key),a=t.filter(l=>!h.includes(l.props.key)&&!o.includes(l.props.key)).filter(l=>{const p=e.find(v=>v.props.key===l.props.key);return JSON.stringify(p.props)!==JSON.stringify(l.props)}).map(l=>l.props.key),u=e.filter(l=>!h.includes(l.props.key)&&!o.includes(l.props.key)&&!a.includes(l.props.key)).map(l=>l.props.key);return[...h.map(l=>({result:z.ADDED,key:l,node:t.find(p=>p.props.key===l).element})),...o.map(l=>({result:z.REMOVED,key:l,node:e.find(p=>p.props.key===l).element})),...a.map(l=>({result:z.CHANGED,key:l,node:e.find(p=>p.props.key===l).element})),...u.map(l=>({result:z.NONE,key:l,node:e.find(p=>p.props.key===l).element}))]}static diffMergeChildren(e,t){const i=e.children;try{const r=f.diffCheckChildren(i,t);for(let h=0;h<r.length;h++){const o=r[h];switch(o.result){case z.ADDED:{const a=t.find(u=>u.props.key===o.key);e.insertChildren(t.indexOf(a),a);break}case z.REMOVED:{const a=e.children.find(u=>(u==null?void 0:u.props.key)===o.key);e.removeChildren(a);break}case z.CHANGED:{const a=e.children.find(l=>(l==null?void 0:l.props.key)===o.key),u=t.find(l=>l.props.key===o.key);C.removeComponentReferences(u),Object.assign(a.props,u.props),f.updateElement(a);break}case z.NONE:default:{const a=e.children.find(l=>l instanceof y&&l.props.key===o.key),u=t.find(l=>l instanceof y&&l.props.key===o.key);u&&C.removeComponentReferences(u),a&&u&&f.diffMergeChildren(a,u.children.filter(l=>l instanceof y))}break}}}catch(r){console.error("failed to diff merge children",e,t,r)}e.children=e.children.filter(r=>r!==null)}static svg(e){const t=document.createElementNS("http://www.w3.org/2000/svg",e.tag),{visible:i,...r}=e.props,h=Object.entries(_(r));for(const[o,a]of h){if(o.includes("bind:"))continue;const u=o==="className"?"class":o;t.setAttribute(u,a.toString())}for(const o of e.children)if(typeof o=="string"||typeof o=="number")t.append(o.toString());else if(typeof o=="function"){const a=o();typeof a=="string"||typeof a=="number"?t.append(a.toString()):t.append(f.svg(a))}else o&&t.append(f.svg(o));return t}static getMountLocation(e,t=0){if(!e.parent)return{element:null,idx:-1};for(let i=0;i<e.parent.children.length;i++){const r=e.parent.children[i];if(r===e)break;t+=f.getRenderedNodeCount(r)}return e.parent.element?{element:e.parent.element,idx:t+1}:f.getMountLocation(e.parent,t)}static getRenderedNodeCount(e){let t=0;if(e instanceof y){if(!e.props.visible)return 0;if(e.tag)return 1;for(const i of e.children)t+=f.getRenderedNodeCount(i);for(const i of e.funcComponents)t+=f.getRenderedNodeCount(i)}else(e instanceof J||typeof e=="string"||typeof e=="number")&&t++;return t}}const g=class g{constructor(){n(this,"serverComponentReferences",[]);n(this,"serverRequest",{path:"/",data:{}})}setServerRequestData(e){this.serverRequest=e}getServerRequestData(e){const t=e.split(".");let i={...this.serverRequest};for(let r=0;r<t.length;r++)if(i=i[t[r]],i===void 0)return;return i}static bake(e,t){const i=new y(t.tagName,{children:[e]});i.element=t,f.render(i)}static getComponentReferences(e){return g.isClient?g.componentReferences:e.cbInstance.serverComponentReferences}static removeComponentReferences(e){g.removeComponentChildReferences(e),g.isClient?g.componentReferences=g.componentReferences.filter(t=>t.component!==e):e.cbInstance.serverComponentReferences=e.cbInstance.serverComponentReferences.filter(t=>t.component!==e)}static removeComponentChildReferences(e){for(const t of e.children)t instanceof y&&g.removeComponentReferences(t)}static logComponentRefCount(e){console.debug("~~ CB REF COUNT",g.isClient?g.componentReferences.length:e.cbInstance.serverComponentReferences.length,performance.now())}static registerRuntimeServices(...e){g.runtimeServices.push(...e)}static getRuntimeService(e){return g.runtimeServices.find(t=>t instanceof e)}};n(g,"DEBUG_COMPONENT_REFCOUNT",!1),n(g,"isClient","window"in globalThis),n(g,"rootMap",new Map),n(g,"componentReferences",[]),n(g,"runtimeServices",[]),n(g,"addComponentReference",e=>{g.isClient?g.componentReferences.push(e):e.component.cbInstance.serverComponentReferences.push(e)});let C=g;class y{constructor(e,t={}){n(this,"parent",null);n(this,"children",[]);n(this,"funcComponents",[]);n(this,"element");n(this,"cbInstance");n(this,"isStatic",!1);n(this,"_mounted",!1);n(this,"subscription");n(this,"_props",{});this.tag=e,"visible"in t||(t.visible=!0),this.props=t}get mounted(){return this._mounted}set mounted(e){const t=this._mounted!==e;this._mounted=e,t&&e&&this._props.onMounted?setTimeout(()=>this._props.onMounted(this),0):t&&!e&&this._props.onUnmounted&&this._props.onUnmounted(this)}get props(){return this._props}set props(e){const{children:t,watch:i,...r}=e;if(Object.assign(this._props,r),t&&this.replaceChildren(t),C.isClient&&i){this._props.watch=i;const h="length"in i?i:[i];for(const o of h){const a=o.subscribe(this.applyBindProps.bind(this));C.addComponentReference({component:this,onDestroyed:()=>a()})}}}get childArgs(){return[]}applyBindProps(){var t;const e=Object.entries(this.props).filter(([i])=>i.startsWith("bind:"));for(const[i,r]of e){const h=i.substring(i.indexOf(":")+1),o=this.getPrimitive(r,()=>f.reRender(this)),a=this._props[h];this._props[h]=h==="children"&&o===!0?a:o,h==="visible"&&C.isClient?o!==a&&(o&&((t=this.parent)!=null&&t._props.visible)?f.reRender(this):f.unRender(this)):h==="children"?(this._props.children&&this.replaceChildren(this._props.children),C.isClient&&f.renderChildren(this)):this.element&&Object.assign(this.element,{[h]:this._props[h]})}}getPrimitive(e,t){return e instanceof J?(t&&this.subscribeTo((i,r)=>e.subscribe(t.bind(this))),e.value):typeof e=="function"?this.getPrimitive(e(this),t):e}subscribeTo(e){if(this.subscription)return;this.subscription=e;const t=r=>{this.props=Object.assign(this.props,r)},i=this.subscription(t,this);C.addComponentReference({component:this,onDestroyed:()=>i()})}removeChildren(...e){for(const t of e){const i=this.children.indexOf(t);t instanceof y&&(this.destroyComponentRefs(t),t.parent=null,f.unRender(t)),this.children[i]=null}}insertChildren(e,...t){this.children.splice(e,0,...t);for(const i of t)i instanceof y&&(i.parent=this,f.reRender(i))}appendChildren(...e){this.children.push(...e);for(const t of e)t instanceof y&&(t.parent=this,f.reRender(t))}prependChildren(...e){this.children.unshift(...e);for(const t of e)t instanceof y&&(t.parent=this,f.reRender(t))}replaceChild(e,t){f.unRender(e),this.destroyComponentRefs(e);const i=this.children.indexOf(e);this.children[i]=t,t.parent=this,f.reRender(t)}replaceChildren(e){this.destroyChildComponentRefs(this),this.children=e.map(t=>Array.isArray(t)?new q(t):t),this.linkChildren()}linkChildren(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t instanceof y&&(t.parent=this,t.cbInstance=this.cbInstance,t.linkChildren())}}destroyChildComponentRefs(e){for(const t of e.children)typeof t=="string"||typeof t=="number"||typeof t!="function"&&t&&this.destroyComponentRefs(t)}shouldRender(){return this._props.visible?this.parent?this.parent.shouldRender():!0:!1}destroyComponentRefs(e){this.destroyChildComponentRefs(e);const t=C.getComponentReferences(e).filter(i=>i.component===e);for(;t.length;)t.pop().onDestroyed();C.removeComponentReferences(e)}onDestroy(){this.props.onDestroyed&&this.props.onDestroyed(this)}getParentOfType(e){if(this.parent)return this.parent instanceof e?this.parent:this.parent.getParentOfType(e)}unMount(){for(const e of this.children)e instanceof y&&e.unMount();this.mounted=!1}recursiveCall(e){e(this);for(const t of this.children)t instanceof y&&t.recursiveCall(e)}isSVG(){var e;try{return this.tag.toLowerCase()==="svg"||!!((e=this.element)!=null&&e.closest("svg"))}catch{return console.error("isSVG ERROR",this.element),!1}}}class q extends y{constructor(e=[]){super("",{children:e})}}const w=(s,e,...t)=>{if(typeof s=="function")return s({...e,children:t},t);let i=e||{};return i.children=t,new y(s,i)},ee=s=>{const e=()=>s.properties.map(a=>`${a.name}: ${a.from}`).join(";"),t=()=>s.properties.map(a=>`${a.name}: ${a.to}`).join(";"),i=Math.max(...s.properties.map(a=>a.ms??300)),r=a=>{!a.element||!C.isClient||a.element.setAttribute("style",`${o()};${t()}`)},h=a=>!a.element||!C.isClient?!1:(a.element.setAttribute("style",`${o()};${e()}`),new Promise(u=>{setTimeout(()=>s.cancelExit&&s.cancelExit()?(r(a),u(!1)):u(!0),i)})),o=()=>`transition: ${s.properties.map(a=>`${a.name} ${a.ms??300}ms`).join(",")}`;return{onMounted:r,onBeforeUnmounted:h,initialStyle:`${o()};${e()}`}},te=({tag:s="div",children:e,properties:t,cancelExit:i,...r})=>{const{onMounted:h,onBeforeUnmounted:o,initialStyle:a}=ee({properties:t,cancelExit:i});return new y(s,{children:e,style:a,onMounted:h,onBeforeUnmounted:o,...r})},ie=!1,c={screenWidth:980,screenHeight:640,sectionHeight:450,gravity:1.25,friction:.5,shopDistance:1e3,testMode:ie,testCoins:51};var k=(s=>(s[s.Rectangle=0]="Rectangle",s[s.Circle=1]="Circle",s))(k||{}),b=(s=>(s[s.Unset=0]="Unset",s[s.Player=1]="Player",s[s.Platform=2]="Platform",s[s.Item=3]="Item",s[s.Turret=4]="Turret",s[s.Projectile=5]="Projectile",s[s.Boss=6]="Boss",s[s.Laser=7]="Laser",s))(b||{}),m=(s=>(s[s.Unset=0]="Unset",s[s.Coin=1]="Coin",s[s.Portal=2]="Portal",s[s.AntiGravity=3]="AntiGravity",s[s.Shop=4]="Shop",s[s.Charger=5]="Charger",s))(m||{}),E=(s=>(s[s.Unset=0]="Unset",s[s.Chill=1]="Chill",s[s.Stun=2]="Stun",s))(E||{});const R=class R{constructor(){n(this,"type",b.Unset);n(this,"pos",{x:0,y:0});n(this,"vel",{x:0,y:0});n(this,"rotation",0);n(this,"speed",3);n(this,"maxSpeedX",12);n(this,"maxSpeedY",100);n(this,"jumpPower",20);n(this,"isJumping",!1);n(this,"hasJumpBoost",!1);n(this,"gravityMultiplier",1);n(this,"frictionMultiplier",1);n(this,"items",new J([]));n(this,"size",{width:0,height:0});n(this,"color","white");n(this,"glowColor","white");n(this,"glows",!1);n(this,"glowSize",10);n(this,"shape",k.Rectangle);n(this,"img",null);n(this,"isStatic",!0);n(this,"affectedByGravity",!1);n(this,"isCollidable",!0);n(this,"isColliding",!1);n(this,"deleted",!1)}get halfSize(){return{width:this.size.width/2,height:this.size.height/2}}shouldDraw(e){return this.pos.y+this.size.height>e.offsetY-c.screenHeight*e.zoomMultiplier&&this.pos.y+this.size.height<e.offsetY+c.screenHeight*e.zoomMultiplier*2}onDestroyed(){}draw(e,t){if(!this.shouldDraw(t))return;e.save();const{offsetX:i,offsetY:r}=t;this.glows?(e.shadowBlur=this.glowSize*t.zoom,e.shadowColor=this.glowColor):e.shadowBlur=0,e.fillStyle=this.color,e.beginPath(),this.rotation!==0&&(e.translate((this.pos.x-i)*t.zoom,(this.pos.y-r)*t.zoom),e.rotate(this.rotation));const h=this.rotation===0?(this.pos.x-i)*t.zoom:0,o=this.rotation===0?(this.pos.y-r)*t.zoom:0,a=this.rotation===0?(this.pos.x-this.halfSize.width-i)*t.zoom:0,u=this.rotation===0?(this.pos.y-this.halfSize.height-r)*t.zoom:0;this.shape===k.Circle?e.arc(h,o,this.halfSize.width*t.zoom,0,Math.PI*2):e.roundRect(a,u,this.size.width*t.zoom,this.size.height*t.zoom,3),e.fill(),e.closePath(),this.img&&e.drawImage(this.img,a,u,this.size.width*t.zoom,this.size.height*t.zoom),e.restore()}tick(){this.applyVelocity(),this.applyGravity(),this.applyFriction()}applyFriction(){this.isStatic||(this.vel.x>0?(this.vel.x-=c.friction*this.frictionMultiplier*R.speedMultiplier,this.vel.x<0&&(this.vel.x=0)):this.vel.x<0&&(this.vel.x+=c.friction*this.frictionMultiplier*R.speedMultiplier,this.vel.x>0&&(this.vel.x=0)))}applyGravity(){if(!(!this.affectedByGravity||this.isStatic)){if(this.pos.y+this.halfSize.height>=c.screenHeight){this.pos.y=c.screenHeight-this.halfSize.height,this.vel.y=0,this.isJumping=!1;return}this.vel.y+=c.gravity*this.gravityMultiplier*R.speedMultiplier}}applyVelocity(){this.isStatic||(this.vel.x>this.maxSpeedX&&(this.vel.x=this.maxSpeedX),this.vel.x<-this.maxSpeedX&&(this.vel.x=-this.maxSpeedX),this.vel.y>this.maxSpeedY&&(this.vel.y=this.maxSpeedY),this.vel.y<-this.maxSpeedY&&(this.vel.y=-this.maxSpeedY),this.pos.x+=this.vel.x*R.speedMultiplier,this.pos.y+=this.vel.y*R.speedMultiplier)}handleCollisions(e){if(this.isCollidable&&!this.isStatic){this.isColliding=!1;for(const t of e)t!==this&&(t.isColliding=!1,t.isCollidable&&this.isCollidingWith(t)&&(this.isColliding=!0,t.isColliding=!0,this.handleCollision(t)))}}handleCollision(e){if(this.type===b.Player)switch(e.type){case b.Boss:this.handleBossCollision(e);break;case b.Platform:this.handlePlatformCollision(e);break;case b.Item:e.interactWith(this);break;case b.Projectile:const i=e;i.deleted=!0,i.statusEffect&&this.statusEffects.add(i.statusEffect);break}else if(this.type===b.Boss)switch(e.type){case b.Platform:this.handlePlatformCollision(e);break;case b.Laser:const t=e;t.deleted=!0,this.onDestroyed();break}}handleBossCollision(e){const t=this.angleTo(e),i=this.distanceTo(e),r=this.halfSize.width+e.halfSize.width-i;this.pos.x+=Math.cos(t)*r,this.pos.y+=Math.sin(t)*r,this.vel.x=-Math.cos(t)*10,this.vel.y=-Math.sin(t)*10,this.isCollidable=!1,this.frictionMultiplier=0,setTimeout(()=>{this.isCollidable=!0,this.frictionMultiplier=1},150)}addItem(e){this.items.value.push(e),this.items.notify()}handlePlatformCollision(e){e.hasBehaviour(x.JumpBoost)&&(this.hasJumpBoost=!0);const t=this.pos.y-this.halfSize.height-this.vel.y,i=this.pos.y+this.halfSize.height-this.vel.y,r=e.pos.y-e.halfSize.height,h=e.pos.y+e.halfSize.height,o=2;this.vel.y>=0&&i-o<=r?(e.hasBehaviour(x.DestroyOnTouch)&&(e.deleted=!0),this.pos.y=e.pos.y-e.halfSize.height-this.halfSize.height+o,this.vel.y=0,this.isJumping=!1,e.hasBehaviour(x.MegaBounce)?this.vel.y=-(this.jumpPower*5):e.hasBehaviour(x.SuperBounce)?this.vel.y=-(this.jumpPower*1.5):e.hasBehaviour(x.Bounce)&&(this.vel.y=-(this.jumpPower*.75))):this.vel.y<=0&&t-o>=h&&e.hasBehaviour(x.NoPassThrough)&&(this.vel.y=-this.vel.y)}isCollidingWith(e){return this.shape===k.Circle?e.shape===k.Circle?this.isCircleCollidingCircle(e):this.isCircleCollidingRectangle(e):e.shape===k.Circle?this.isCircleCollidingRectangle(e):this.isRectangleCollidingRectangle(e)}isCircleCollidingCircle(e){return Math.sqrt(Math.pow(e.pos.x-this.pos.x,2)+Math.pow(e.pos.y-this.pos.y,2))<this.halfSize.width+e.halfSize.width}isCircleCollidingRectangle(e){const t={x:Math.abs(this.pos.x-e.pos.x),y:Math.abs(this.pos.y-e.pos.y)};return t.x>e.halfSize.width+this.halfSize.width||t.y>e.halfSize.height+this.halfSize.height?!1:t.x<=e.halfSize.width||t.y<=e.halfSize.height?!0:Math.pow(t.x-e.halfSize.width,2)+Math.pow(t.y-e.halfSize.height,2)<=Math.pow(this.halfSize.width,2)}isRectangleCollidingRectangle(e){return this.pos.x+this.halfSize.width>e.pos.x-e.halfSize.width&&this.pos.x-this.halfSize.width<e.pos.x+e.halfSize.width&&this.pos.y+this.halfSize.height>e.pos.y-e.halfSize.height&&this.pos.y-this.halfSize.height<e.pos.y+e.halfSize.height}distanceTo(e){return Math.sqrt(Math.pow(e.pos.x-this.pos.x,2)+Math.pow(e.pos.y-this.pos.y,2))}angleTo(e){const t=e.pos.x-this.pos.x,i=e.pos.y-this.pos.y;return Math.atan2(i,t)}};n(R,"speedMultiplier",1);let S=R;var x=(s=>(s[s.Bounce=0]="Bounce",s[s.SuperBounce=1]="SuperBounce",s[s.MegaBounce=2]="MegaBounce",s[s.JumpBoost=3]="JumpBoost",s[s.MovesX=4]="MovesX",s[s.MovesY=5]="MovesY",s[s.DestroyOnTouch=6]="DestroyOnTouch",s[s.NoPassThrough=7]="NoPassThrough",s))(x||{});class H extends S{constructor({pos:t,size:i,behaviours:r=[]}){super();n(this,"behaviours",[]);n(this,"moveSpeed",Math.random()*2+1);n(this,"moveDirectionX",1);n(this,"moveDirectionY",1);n(this,"moveDistanceX",200);n(this,"moveDistanceY",100);n(this,"moveDistanceTravelledX",0);n(this,"moveDistanceTravelledY",0);this.type=b.Platform,this.pos=t,this.size=i,this.color="#66A",this.isStatic=!0,this.behaviours=r,this.glows=!0,this.glowSize=3,this.glowColor="#000A",this.hasBehaviour(2)?(this.color="gold",this.glowColor="#FF0A"):this.hasBehaviour(1)?(this.color="#55F",this.glowColor="#228C"):this.hasBehaviour(6)&&(this.color="#66A8",this.glows=!1)}static randomPlatform(t,i={width:Math.random()*100+60,height:Math.random()*10+20},r=[]){return r.length>0?new H({pos:t,size:i,behaviours:r}):(r.push(0),Math.random()>.95&&r.push(6),Math.random()>.95&&r.push(1),Math.random()>.99&&r.push(2),Math.random()>.5&&r.push(4),Math.random()>.5&&r.push(5),new H({pos:t,size:i,behaviours:r}))}tick(){this.hasBehaviour(4)&&this.moveX(),this.hasBehaviour(5)&&this.moveY()}moveX(){this.vel.x=this.moveSpeed*this.moveDirectionX,this.pos.x+=this.vel.x*S.speedMultiplier,this.moveDistanceTravelledX+=this.moveSpeed,this.moveDistanceTravelledX>=this.moveDistanceX&&(this.moveDirectionX*=-1,this.moveDistanceTravelledX=0)}moveY(){this.vel.y=this.moveSpeed*this.moveDirectionY,this.pos.y+=this.vel.y*S.speedMultiplier,this.moveDistanceTravelledY+=this.moveSpeed,this.moveDistanceTravelledY>=this.moveDistanceY&&(this.moveDirectionY*=-1,this.moveDistanceTravelledY=0)}hasBehaviour(t){return this.behaviours.includes(t)}}var F=(s=>(s.SlowMo="SlowMo",s.DoubleJump="DoubleJump",s))(F||{});class K{constructor(e,t=50){n(this,"img");n(this,"cost",100);switch(this.type=e,this.price=t,e){case"SlowMo":this.img=M.value.find(i=>i.name==="snail.png").image,this.cost=1;break;case"DoubleJump":this.img=M.value.find(i=>i.name==="boot.png").image;break}if(!this.img)throw new Error("No image found for ability "+e)}use(e){switch(this.type){case"SlowMo":S.speedMultiplier=.5;break;case"DoubleJump":e.vel.y-=e.jumpPower*2;break}}unuse(e){switch(this.type){case"SlowMo":S.speedMultiplier=1;break}}render(e,t,i){e.drawImage(this.img,t.x-i/2,t.y-i/2,i,i)}}class se{constructor(e,t){n(this,"type",E.Unset);n(this,"img",null);n(this,"duration",0);var i;switch(this.type=e,this.duration=t,e){case E.Chill:this.img=((i=M.value.find(r=>r.name==="thaw.png"))==null?void 0:i.image)||null;break}}tick(){this.duration-=1e3/60,this.duration<=0&&(this.type=E.Unset)}draw(e,t,i,r){this.img&&e.drawImage(this.img,(t.x-i/2)*r.zoom,t.y*r.zoom,i*r.zoom,i*r.zoom)}}class re{constructor(){n(this,"effects",[])}draw(e,t,i,r){this.effects.forEach(h=>{h.draw(e,{x:t.x-i.offsetX,y:t.y-r.height/2-i.offsetY},r.width,i)})}has(e){return this.effects.some(t=>t.type===e)}add(e){this.effects=this.effects.filter(t=>t.type!==e.type),this.effects.push(e)}tick(){this.effects.forEach(e=>{e.tick()}),this.effects=this.effects.filter(e=>e.type!=E.Unset)}}class ne extends S{constructor(){super();n(this,"velocityParticles",[]);n(this,"abilities",[]);n(this,"coins",new J([]));n(this,"abilityJuiceCost",100);n(this,"abilityJuice",0);n(this,"maxAbilityJuice",300);n(this,"defaultColor","#69c");n(this,"chilledColor","#8ac");n(this,"statusEffects",new re);n(this,"inputs",{left:!1,right:!1,up:!1,down:!1,interact:!1,ability1:!1,ability2:!1,ability3:!1});this.type=b.Player,this.size.width=50,this.size.height=50,this.pos.x=c.screenWidth/2,this.pos.y=c.screenHeight-this.halfSize.height,this.isStatic=!1,this.affectedByGravity=!0,this.color=this.defaultColor,this.glows=!0,this.glowColor="#000A",this.glowSize=3,this.abilities.push(new K(F.DoubleJump)),this.attachKeybinds()}get isChilled(){return this.statusEffects.has(E.Chill)}get isStunned(){return this.statusEffects.has(E.Stun)}get numCoins(){return this.coins.value.length}get distanceFromGround(){return c.screenHeight-this.pos.y-this.halfSize.height}tick(){this.isColliding||(this.hasJumpBoost=!1),this.vel.y<0&&this.isJumping?this.size.width=Math.min(50,50-Math.abs(this.vel.y)/1.5):this.size.width=50,this.statusEffects.tick(),this.emitVelocityParticles(),this.handleInputs(),this.color=this.defaultColor,this.isChilled&&(this.color=this.chilledColor,this.vel.x*=.9,this.vel.y<0?this.vel.y*=.9:this.vel.y*=.95),this.isStunned&&(this.vel.x=0,this.vel.y=0),super.tick(),this.abilities.length>0&&this.vel.y<0&&(this.abilityJuice+=-this.vel.y/42,this.abilityJuice>this.maxAbilityJuice&&(this.abilityJuice=this.maxAbilityJuice))}addItem(t){switch(t.itemType){case m.Coin:this.coins.value.push(t),this.coins.notify();break;default:this.items.value.push(t),this.items.notify();break}}draw(t,i){this.drawVelocityParticles(t,i),super.draw(t,i),this.abilities.length>0&&(this.renderAbilityJuiceBar(t),this.renderAbilities(t)),this.statusEffects.draw(t,this.pos,i,this.size)}renderAbilityJuiceBar(t){const i="#a28c17aa",r="#d5bb30",o=this.maxAbilityJuice,a=c.screenWidth-10-10,u=c.screenHeight-o-10;t.shadowBlur=0,t.fillStyle=i,t.fillRect(a,u,10,o);const l=this.abilityJuice/this.maxAbilityJuice*o;t.fillStyle=r,t.fillRect(a,u+o-l,10,l);const p=2,v=Math.floor(o/this.abilityJuiceCost);t.fillStyle=i;for(let B=0;B<v;B++){const j=u+(B+1)*this.abilityJuiceCost;t.fillRect(a,j,10,p)}}renderAbilities(t){const h=c.screenWidth-50-10-30,o=c.screenHeight-50-10;this.abilities.forEach((a,u)=>{t.strokeStyle="#0004",t.fillStyle="#0004",t.lineWidth=2;const l=this.abilities.length-u-1;t.beginPath(),t.roundRect(h-l*50,o,50,50,5),t.fill(),t.stroke(),t.closePath();const p=5;t.drawImage(a.img,h+p-l*50,o+p,50-p*2,50-p*2),t.fillStyle="#fff",t.font="bold 10px sans-serif",t.textAlign="center";let v="space";switch(u){case 0:v="space";break;case 1:v="c";break;case 2:v="v";break;case 3:v="b";break}t.fillText(v,50/2+h-l*50,o)})}drawVelocityParticles(t,i){this.velocityParticles.length!==0&&(t.shadowBlur=0,this.velocityParticles.forEach(r=>{t.fillStyle=r.color,t.fillRect((r.pos.x-r.size/2-i.offsetX)*i.zoom,(r.pos.y-i.offsetY)*i.zoom,r.size*i.zoom,r.size*i.zoom)}))}emitVelocityParticles(){const i=Math.abs(this.vel.x),r=Math.abs(this.vel.y),h="#55F";if(i>5){const o={pos:{x:this.pos.x,y:this.pos.y},color:h,size:i/3};this.velocityParticles.push(o)}if(r>5){const o={pos:{x:this.pos.x,y:this.pos.y},color:h,size:r/3};this.velocityParticles.push(o)}this.velocityParticles.forEach(o=>{o.size*=.9}),this.velocityParticles=this.velocityParticles.filter(o=>o.size>.5)}handleInputs(){this.inputs.left&&(this.vel.x-=this.speed),this.inputs.right&&(this.vel.x+=this.speed),this.inputs.up&&!this.isJumping&&(this.vel.y>0&&(this.vel.y=0),this.vel.y-=this.jumpPower*(this.hasJumpBoost?2:1),this.isJumping=!0),this.inputs.down&&(this.vel.y+=this.speed/2);const t=this.abilities[1];t&&(this.inputs.ability1&&this.abilityJuice>=t.cost?(t.use(this),this.abilityJuice-=t.cost):t.unuse(this));const i=this.abilities[2];i&&(this.inputs.ability2&&this.abilityJuice>=i.cost?(i.use(this),this.abilityJuice-=i.cost):i.unuse(this));const r=this.abilities[3];r&&(this.inputs.ability3&&this.abilityJuice>=r.cost?(r.use(this),this.abilityJuice-=r.cost):r.unuse(this))}attachKeybinds(){window.addEventListener("keydown",t=>{switch(t.key.toLowerCase()){case"a":this.inputs.left=!0;break;case"d":this.inputs.right=!0;break;case"w":this.inputs.up=!0;break;case"s":this.inputs.down=!0;break;case"f":this.inputs.interact=!0;break;case"c":this.inputs.ability1=!0;break;case"v":this.inputs.ability2=!0;break;case"b":this.inputs.ability3=!0;break}}),window.addEventListener("keypress",t=>{switch(t.key.toLowerCase()){case" ":const i=this.abilities.find(r=>r.type===F.DoubleJump);this.abilityJuice>=i.cost&&(i.use(this),this.abilityJuice-=i.cost);break}}),window.addEventListener("keyup",t=>{switch(t.key.toLowerCase()){case"a":this.inputs.left=!1;break;case"d":this.inputs.right=!1;break;case"w":this.inputs.up=!1;break;case"s":this.inputs.down=!1;break;case"f":this.inputs.interact=!1;break;case"c":this.inputs.ability1=!1;break;case"v":this.inputs.ability2=!1;break;case"b":this.inputs.ability3=!1;break}})}}class A extends S{constructor(t,i){super();n(this,"itemType",m.Unset);n(this,"isInteracting",!1);this.type=b.Item,this.pos=t,this.itemType=i,this.size={width:42,height:42},this.color="transparent",this.glowColor="#FF0",this.glows=!0,this.setImg()}setImg(){var t,i,r,h;switch(this.itemType){case m.Coin:this.img=((t=M.value.find(o=>o.name==="coin.png"))==null?void 0:t.image)||null,this.shape=k.Circle;break;case m.AntiGravity:this.img=((i=M.value.find(o=>o.name==="antigravity.png"))==null?void 0:i.image)||null;break;case m.Shop:this.img=((r=M.value.find(o=>o.name==="shop.png"))==null?void 0:r.image)||null,this.glows=!1;break;case m.Charger:this.img=((h=M.value.find(o=>o.name==="charger.png"))==null?void 0:h.image)||null,this.glows=!1;break}}tick(){if(this instanceof W&&this.otherPortal){if(this.isColliding||this.otherPortal.isColliding)return;this.isInteracting=!1,this.otherPortal.isInteracting=!1;return}this.itemType===m.Shop&&this===(d==null?void 0:d.currentShop)&&!this.isColliding&&N.value&&(N.value=!1)}interactWith(t){switch(this.itemType){case m.Portal:if(this instanceof W&&this.otherPortal){if(this.isInteracting||this.otherPortal.isInteracting)return;this.isInteracting=!0,this.otherPortal.isInteracting=!0,this.otherPortal.isColliding=!0,t.pos.x=this.otherPortal.pos.x,t.pos.y=this.otherPortal.pos.y,setTimeout(()=>{this instanceof W&&this.otherPortal&&(this.otherPortal.isColliding=!1)},100)}break;case m.Coin:t.addItem(this),this.deleted=!0;break;case m.AntiGravity:t.gravityMultiplier-=.5,setTimeout(()=>{t.gravityMultiplier+=.5},4e3),this.deleted=!0;break;case m.Shop:if(N.value)return;N.value=!0;break}}}const P=class P extends A{constructor(t,i){super(t,m.Portal);n(this,"otherPortal",null);this.idx=i,this.size.width=P.portalSize,this.size.height=P.portalSize,this.glowColor="#0FF",this.setImg()}static createPair(t){const i=P.portalSize,r=i+Math.random()*(c.screenWidth-i),h={x:r,y:Math.random()*500+100+t},a=Math.random()>.5?h.y-100-Math.random()*300:h.y+100+Math.random()*300,u={x:r>c.screenWidth/2?r-c.screenWidth/2:r+c.screenWidth/2,y:a},l=new P(h,0),p=new P(u,1);return l.otherPortal=p,p.otherPortal=l,[l,p]}setImg(){var t;this.img=((t=M.value.find(i=>i.name===`portal${this.idx===0?"2":""}.png`))==null?void 0:t.image)||null}};n(P,"portalSize",100);let W=P;class oe extends A{constructor(e){super(e,m.Shop),this.size={width:64,height:64},this.glowColor="#FF0"}}class he{constructor(e){n(this,"offsetY",0);n(this,"offsetX",0);n(this,"targetY",0);n(this,"targetX",0);n(this,"zoom",1);this.player=e}get zoomMultiplier(){return 1/this.zoom}tick(){this.targetY=this.player.pos.y,this.targetX=this.player.pos.x,this.targetY>c.screenHeight/2&&(this.targetY=c.screenHeight/2),this.lerpToTarget()}lerpToTarget(){const t=this.targetY-c.screenHeight/2*this.zoomMultiplier-this.offsetY;this.offsetY+=t*.15;const r=this.targetX-c.screenWidth/2*this.zoomMultiplier-this.offsetX;this.offsetX+=r*.15}}class le extends S{constructor(t,i,r,h){super();n(this,"maxSpeedX",30);n(this,"maxSpeedY",30);n(this,"gravityMultiplier",.5);this.pos=t,this.vel=i,this.statusEffect=h,this.type=b.Projectile,this.pos=t,this.vel=i,this.isCollidable=!0,this.isStatic=!1,this.shape=k.Circle,this.size={width:r*2,height:r*2},this.affectedByGravity=!0,this.frictionMultiplier=.5}tick(){super.tick()}}class ae extends S{constructor(t,i,r){super();n(this,"shootRange",c.screenWidth);n(this,"shootCooldown",1e3);n(this,"lastShot",0);this.pos=t,this.enemies=i,this.addProj=r,this.type=b.Turret,this.shape=k.Circle,this.size={width:50,height:50},this.isCollidable=!1,this.isStatic=!0,this.color="#F00A"}tick(){this.lastShot+=1e3/60;const t=this.getEnemyInRange();t&&this.lastShot>=this.shootCooldown&&(this.shoot(t),this.lastShot=0)}getEnemyInRange(){for(const t of this.enemies){const i=this.distanceTo(t);if(!(t.deleted||i>this.shootRange))return t}return null}shoot(t){const i=this.angleTo(t),r={x:Math.cos(i)*30,y:Math.sin(i)*30},h=new le({x:this.pos.x,y:this.pos.y},r,10,new se(E.Chill,1e3));h.color="#F00",this.addProj(h)}}class ce extends S{constructor(t,i){super();n(this,"size",{width:100,height:100});n(this,"jumpCooldown",0);n(this,"jumpCooldownMax",1e3);n(this,"jumpPower",35);n(this,"frictionMultiplier",.5);this.player=i,this.pos=t,this.type=b.Boss,this.img=M.value.find(r=>r.name==="angryface.png").image,this.color="#F44",this.glowColor="red",this.glowSize=12,this.glows=!0,this.isStatic=!1,this.affectedByGravity=!0,this.isCollidable=!0,this.isColliding=!1}tick(){super.tick(),this.jumpCooldown+=1e3/60,this.jumpCooldown>=this.jumpCooldownMax&&!this.isJumping?(this.size.height=100,this.jumpCooldown=0,this.jump()):!this.isJumping&&this.size.height>50&&(this.size.height-=1.5)}jump(){this.vel.y=-this.jumpPower*.75,this.vel.x=this.player.pos.x<this.pos.x?-this.jumpPower*50:this.jumpPower*50,this.isJumping=!0}handlePlatformCollision(t){const i=this.pos.y+this.halfSize.height-this.vel.y,r=t.pos.y-t.halfSize.height,h=2;this.vel.y>=0&&i-h<=r&&(this.pos.y=t.pos.y-t.halfSize.height-this.halfSize.height+h,this.vel.y=0,this.isJumping=!1)}}class ue{constructor(){n(this,"camera");n(this,"score",0);n(this,"player");n(this,"platforms",[]);n(this,"turrets",[]);n(this,"projectiles",[]);n(this,"lasers",[]);n(this,"items",[]);n(this,"bosses",[]);n(this,"maxSection");n(this,"isGameOver",!1);n(this,"currentShop",null);n(this,"directionIndicator",null);n(this,"directionIndicatorIcon",null);n(this,"speedMultiplier",1);n(this,"horizontalVariation",0);this.player=new ne,this.platforms=[new H({size:{width:250,height:20},pos:{x:200,y:c.screenHeight-120},behaviours:[x.Bounce,x.MovesX]})],this.camera=new he(this.player),this.maxSection=1,this.generateNextSection()}removeItem(e){this.items.splice(this.items.indexOf(e),1)}tick(){this.handleCollisions();for(const t of this.platforms)t.tick();this.platforms=this.platforms.filter(t=>!t.deleted);for(const t of this.items)t.tick();this.items=this.items.filter(t=>!t.deleted);for(const t of this.turrets)t.tick();this.turrets=this.turrets.filter(t=>!t.deleted);for(const t of this.projectiles)t.tick(),t.distanceTo(this.player)>c.screenHeight*4&&(t.deleted=!0);this.projectiles=this.projectiles.filter(t=>!t.deleted);for(const t of this.lasers)t.tick();this.lasers=this.lasers.filter(t=>!t.deleted);for(const t of this.bosses)t.tick();this.bosses=this.bosses.filter(t=>!t.deleted),this.player.tick(),this.camera.tick(),this.score=0,this.score=Math.floor(Math.abs(this.player.pos.y-c.screenHeight+this.player.halfSize.height)/50);let e=Math.abs(Math.floor(this.player.pos.y/c.sectionHeight))+1;e>this.maxSection&&(this.maxSection=e,this.generateNextSection()),this.renderShopIndicator()}renderShopIndicator(){if(this.currentShop=this.items.filter(e=>e.itemType===m.Shop).sort((e,t)=>{const i=Math.sqrt(Math.pow(e.pos.x-this.player.pos.x,2)+Math.pow(e.pos.y-this.player.pos.y,2)),r=Math.sqrt(Math.pow(t.pos.x-this.player.pos.x,2)+Math.pow(t.pos.y-this.player.pos.y,2));return i-r})[0],this.currentShop){const e=this.currentShop.pos,t=this.player.pos;let i=0,r=0;const h=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));if(h>c.screenHeight/2&&h<c.screenHeight*2){const o=Math.atan2(e.y-t.y,e.x-t.x);i=c.screenWidth/2+Math.cos(o)*250,r=c.screenHeight/2+Math.sin(o)*250,this.directionIndicator={x:i,y:r},this.directionIndicatorIcon=this.currentShop.img}else this.clearDirectionIndicator()}else this.clearDirectionIndicator()}clearDirectionIndicator(){this.directionIndicator=null,this.directionIndicatorIcon=null}generateNextSection(){const e=[],i=c.screenWidth/3;let r=!1;for(let h=0;h<3;h++){const o=!r&&this.maxSection%c.shopDistance===0,a=100,u=this.horizontalVariation+Math.random()*(h+1)*i,l=o?c.sectionHeight-this.maxSection*c.sectionHeight:c.sectionHeight-this.maxSection*c.sectionHeight+Math.random()*a-a/2;if(o){let p=Math.random()*c.screenWidth;this.items.push(new oe({x:p,y:l-48})),r=!0,e.push(H.randomPlatform({x:p,y:l},{height:30,width:160},[x.JumpBoost]));break}if(Math.random()>.66)this.items.push(new A({x:u,y:l-c.sectionHeight/2},m.Coin)),Math.random()>.66&&(this.items.push(new A({x:u,y:l-c.sectionHeight/2-64},m.Coin)),Math.random()>.66&&this.items.push(new A({x:u,y:l-c.sectionHeight/2-128},m.Coin)));else if(this.maxSection%8===0){if(Math.random()>.8){const p=c.sectionHeight-(this.maxSection+1)*c.sectionHeight;this.items.push(new A({x:u,y:p},m.AntiGravity))}}else this.maxSection%3===0&&this.maxSection>5&&Math.random()>.8&&this.turrets.push(new ae({x:u,y:l-100},[this.player],this.addProjectile.bind(this)));this.maxSection>50&&this.maxSection%3===0&&Math.random()>.6&&this.bosses.push(new ce({x:u,y:l-100},this.player)),e.push(H.randomPlatform({x:u,y:l}))}this.horizontalVariation+=Math.random()*300-150,this.platforms.push(...e)}addProjectile(e){this.projectiles.push(e)}addLaser(e){this.lasers.push(e)}handleCollisions(){this.player.handleCollisions([...this.platforms,...this.items,...this.projectiles,...this.bosses]),this.bosses.forEach(e=>{e.handleCollisions([...this.platforms,...this.lasers])})}onShopContinueClick(){this.player.vel.y-=50}onShopAbilityClick(e){this.player.abilities.push(e),D.value=D.value.filter(t=>t!==e),this.player.coins.value.splice(0,e.price),this.player.coins.notify()}}const Y=X({});Y.subscribe(s=>{s.canvas&&(s.canvas.width=c.screenWidth,s.canvas.height=c.screenHeight,s.ctx=s.canvas.getContext("2d")),s.bgCanvas&&(s.bgCanvas.width=c.screenWidth,s.bgCanvas.height=c.screenHeight,s.bgCtx=s.bgCanvas.getContext("2d"))});let d;const fe=()=>{d=new ue},N=X(!1),D=X([]),M=X([]),I=X(null),O=X(0),T=[{image:"space.png",speed:.166},{image:"coin.png",speed:.166},{image:"portal.png",speed:0},{image:"portal2.png",speed:0},{image:"antigravity.png",speed:0},{image:"shop.png",speed:0},{image:"snail.png",speed:0},{image:"boot.png",speed:0},{image:"thaw.png",speed:0},{image:"angryface.png",speed:0},{image:"charger.png",speed:0}];let V=0;const de=s=>{T.forEach(e=>{const t=new Image;t.src=`../img/${e.image}`,t.onload=()=>{V++,V===T.length&&s()},M.value.push({image:t,speed:e.speed,name:e.image})})},pe=()=>{let s,e;const t=()=>{s&&e&&(Y.value={canvas:s,bgCanvas:e},de(()=>{const i=M.value.find(r=>r.name==="space.png");if(!i)throw new Error("Background image not loaded");I.value=i.image,O.value=i.speed,ye()}))};return w("div",{style:{width:c.screenWidth+"px",height:c.screenHeight+"px",position:"relative"}},w("canvas",{id:"bg-canvas",onMounted:i=>{e=i.element,t()}}),w("canvas",{onMounted:i=>{s=i.element,t()}}),w(te,{properties:[{name:"opacity",from:"0",to:"1"}],id:"shop-ui",watch:N,"bind:visible":()=>N.value,cancelExit:()=>N.value},w("h1",null,"Shop"),w("div",{className:"shop-inventory",watch:D,"bind:children":!0},()=>D.value.length>0?D.value.map(i=>w(ge,{ability:i})):w("i",null,"All abilities purchased"))))},ge=({ability:s})=>{const e=d.player;return w("button",{className:"shop-ability",onclick:()=>d.onShopAbilityClick(s),watch:e.coins,"bind:disabled":()=>e.numCoins<s.price,"bind:title":()=>e.numCoins>=s.price?"":"Not enough coins"},w("span",{className:"shop-ability-title"},s.type),w("img",{src:s.img.src}),w("small",{className:"shop-ability-price"},s.price))};let L=null;function ye(){if(!I.value)throw new Error("Background image not loaded");let s=Y.value.ctx,e=Y.value.bgCtx;if(!s)throw new Error("Context not loaded");if(!e)throw new Error("Background context not loaded");D.value=[new K(F.SlowMo)],L=e.createPattern(I.value,"repeat"),e.fillStyle=L,e.fillRect(-c.screenWidth*500,-c.screenHeight*999,c.screenWidth*1e3,c.screenHeight*1e3),fe(),window.setInterval(()=>{me()},1e3/60)}let U=0,$=0;function me(){let s=Y.value.ctx,e=Y.value.bgCtx;if(!d||!s||!e)return;s.clearRect(0,0,c.screenWidth,c.screenHeight),d.tick();for(const o of d.platforms)o.draw(s,d.camera);for(const o of d.items)o.draw(s,d.camera);for(const o of d.turrets)o.draw(s,d.camera);for(const o of d.projectiles)o.draw(s,d.camera);for(const o of d.bosses)o.draw(s,d.camera);for(const o of d.lasers)o.draw(s,d.camera);if(d.player.draw(s,d.camera),d.directionIndicator&&d.directionIndicatorIcon){const{x:o,y:a}=d.directionIndicator;s.drawImage(d.directionIndicatorIcon,o,a,50,50)}const t=-d.camera.offsetY-U;U=-d.camera.offsetY;const i=-d.camera.offsetX-$;$=-d.camera.offsetX;const r=Math.round(t*O.value),h=Math.round(i*O.value);e.translate(h,r),e.fillRect(-c.screenWidth*500,-c.screenHeight*999,c.screenWidth*1e3,c.screenHeight*1e3),s.textAlign="left",s.fillStyle="white",s.font="13px monospace",s.fillText(`Height: ${d.score}`,10,20),s.fillText(`Coins: ${d.player.numCoins}`,10,40)}const ve=document.getElementById("app");C.bake(pe(),ve);
